NAME := libft.a
SUBDIRS = $(notdir $(shell find . -type d -maxdepth 1 -not -name "." -not -path "./.*" | sort))
TOP := $(shell pwd)

ifndef CC
	CC = cc
endif
ifndef CFLAGS
	CFLAGS = -Wall -Wextra -Werror
endif

export ODIR := objs
export SDIR := srcs
export HDIR := $(TOP)
export CC
export CFLAGS

LIBS := $(foreach DIR, $(SUBDIRS), $(addsuffix /$(patsubst %,lib%.a, $(notdir $(DIR))), $(DIR)))

.PHONY: all clean fclean re $(SUBDIRS)

all: $(NAME)

$(NAME): $(LIBS)
	@echo "Compiling libft from sub-libraries..."
	@libtool -static -o $@ $^
	@echo "Done!"

$(LIBS): $(SUBDIRS)

$(SUBDIRS):
	@$(MAKE) -C $@ $(MAKECMDGOALS)

clean: $(SUBDIRS)

fclean: $(SUBDIRS)
	@echo "Fully cleaning libft..."
	@rm -vf $(NAME)
	@echo "Done!"

re: fclean all
